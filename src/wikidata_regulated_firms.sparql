SELECT DISTINCT ?company ?companyLabel ?isin_value ?lei_value WHERE {
  SERVICE wikibase:label { bd:serviceParam wikibase:language "en,de,fr,it". }
  {
    SELECT DISTINCT ?company ?isin_value ?lei_value WHERE {
      VALUES ?countries_de_fr_it {wd:Q183 wd:Q142 wd:Q38}
      {
        ?company p:P31 ?statement0.
        ?statement0 (ps:P31) wd:Q891723.
      }
      UNION
      {
        ?company p:P946 ?statement1.
        ?statement1 (ps:P946) ?isin_value.
      }
      {
        ?company p:P17 ?statement2.
        ?statement2 (ps:P17) ?countries_de_fr_it.
      }
      OPTIONAL {
        ?company p:P1278 ?legal_identifier_id.
        ?legal_identifier_id (ps:P1278) ?lei_value.
      }
    }
    LIMIT 5000
  }
}
